<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Gilbert">

<title>Enter the Tidyverse: An Introduction to Tidy Data Analysis in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Day2_TidyAnalyses_newStudents_files/libs/clipboard/clipboard.min.js"></script>
<script src="Day2_TidyAnalyses_newStudents_files/libs/quarto-html/quarto.js"></script>
<script src="Day2_TidyAnalyses_newStudents_files/libs/quarto-html/popper.min.js"></script>
<script src="Day2_TidyAnalyses_newStudents_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Day2_TidyAnalyses_newStudents_files/libs/quarto-html/anchor.min.js"></script>
<link href="Day2_TidyAnalyses_newStudents_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Day2_TidyAnalyses_newStudents_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Day2_TidyAnalyses_newStudents_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Day2_TidyAnalyses_newStudents_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Day2_TidyAnalyses_newStudents_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="Day2_TidyAnalyses_newStudents_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="Day2_TidyAnalyses_newStudents_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Enter the Tidyverse: An Introduction to Tidy Data Analysis in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Gilbert </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p><strong>Purpose:</strong> This notebook addresses the following items.</p>
<ul>
<li>How do I install and load packages in R? In particular we’ll work with the <code>{tidyverse}</code>.</li>
<li>How do I read data into R from both local and remote sources?</li>
<li>How do I interact with, and manipulate, data using the tools and principles of the <code>{tidyverse}</code>?</li>
</ul>
<p><strong>Note:</strong> Below, you’ll be asked to build a Quarto notebook which includes many code cells to accomplish tasks. In addition to the code cells (grey background), be sure to leave yourself short notes in text cells (white background) which describe what you are doing with the code. Having a notebook that consists of 25 code cells with no additional context at the end of this discussion won’t be very useful. You’ll also be adding to this notebook later, so including some limited discussions now will be helpful!</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>Open RStudio and use <code>File -&gt; New File -&gt; Quarto Document...</code> to create a new Quarto Markdown (<code>*.qmd</code>) file. Fill in the title field with <code>Tidy Analysis of MLB Batted Balls</code>, update the author field with your name if it is not already there. Uncheck the option to <em>Use visual markdown editor</em>, leave the remaining default settings, and click <em>Create</em>.</p>
<p>You can see several items in this sample markdown file. We’ll cover them in detail later, but for now</p>
<ul>
<li>the top of the document contains a header with information about the notebook.</li>
<li>any text over a grey background is executable code.</li>
<li>any text over a white background is free-form text.</li>
</ul>
<p>You can remove all the <em>boilerplate</em> from line 6 down.</p>
</section>
<section id="installing-and-loading-packages" class="level2">
<h2 class="anchored" data-anchor-id="installing-and-loading-packages">Installing and Loading Packages</h2>
<p>We can install R packages using the command <code>install.packages("PACKAGE_NAME")</code>. Once packages are installed, we can load them into an R Session by running <code>library(PACKAGE_NAME)</code>.</p>
<ol type="1">
<li>Install the <code>{tidyverse}</code> by typing <code>install.packages("tidyverse")</code> into the console. That’s the lower-left pane in your RStudio window.</li>
</ol>
<ul>
<li>The console is great for running “one-off” code that you won’t need again, like code for installing libraries.</li>
<li>Since we’re talking about libraries, install <code>{tidymodels}</code>, <code>{patchwork}</code>, and <code>{kableExtra}</code> in the console since we’ll be using these later in our course.</li>
</ul>
<p>New functionality isn’t made available immediately after it is installed. Any packages we wish to use must be loaded into the R session where we’ll be using them. An R Session begins when R/RStudio are opened and ends when they are closed or terminated. We can load packages with the <code>library()</code> command. For example, to load <code>{tidyverse}</code>, we run <code>library(tidyverse)</code>.</p>
<ol start="2" type="1">
<li>In the first code chunk in your notebook pane (that’s the top left), add a new line and load the <code>{tidyverse}</code>. Make sure that line is inside the code chunk, appearing over a grey background. You can run that line by hitting <code>ctrl+Enter</code> (PC) or <code>cmd+Return</code> (Mac).</li>
</ol>
</section>
<section id="loading-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-data">Loading Data</h2>
<p>Now that you have the <code>{tidyverse}</code> loaded, the next thing we’ll need is actual data to manipulate. The <code>{tidyverse}</code> comes with a few standard data sets for practicing with, but we’ll be much more interested in working with our own data which we’ll either find locally (stored on our own computers) or remotely (accessed via a web URL). The <code>{tidyverse}</code> includes several functions for reading data in a variety of formats:</p>
<ul>
<li><code>read_csv("PATH_TO_FILE")</code> can be used to read data from a comma separated values (csv) file.</li>
<li><code>read_delim("PATH_TO_FILE", delim = "DELIMITER")</code> is a more general version of the <code>read_csv()</code> function – we can use this to read text files whose delimiter is something other than a comma. Common delimiters are the tab (<code>\t</code>) or space (<code>\s</code>).</li>
<li><code>read_excel("PATH_TO_FILE", sheet = "SHEET_NAME")</code> can be used to read data from a particular sheet within an xls or xlsx file.</li>
</ul>
<p>The following examples show how we can read a variety of files into an R Session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Read the MAT241 sheet from the grades.xls file in </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the Spring 2021 folder on my computer's desktop</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>grades <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"C:/Users/agilb/Desktop/Spring 2021/grades.xls"</span>, <span class="at">sheet =</span> <span class="st">"MAT241"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Read in data from a csv file of Tate Gallery Artists housed </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#in a public github repository on the web</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>tate_artists <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://github.com/tategallery/collection/raw/master/artist_data.csv"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Read in data from a csv file of Tate Gallery Artworks housed</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#in a public github repository on the web</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#*Note* that read_csv() would have worked just fine here too</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>tate_works <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-01-12/artwork.csv"</span>, <span class="at">delim =</span> <span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now it’s time for you to load in some data. We’ll work with two data sets in this notebook: <code>battedballs.csv</code> and <code>park_dimensions.csv</code>. You can find those data sets in one of my GitHub repositories <a href="https://github.com/agmath/agmath.github.io/tree/master/data/classification">here</a>. In order to read these into R, we’ll need a link to the raw data sources.</p>
<ol start="3" type="1">
<li>Complete the following to read in the <code>battedballs.csv</code> file.</li>
</ol>
<ul>
<li>Click on <code>battedballs.csv</code> in the file listing in the GitHub repository.</li>
<li>Look for the button labeled <code>Raw</code> appearing above the data, and click it. The button is in the grey banner.</li>
<li>Copy the URL that appears in your web browser.</li>
<li>Return to your Quarto notebook in RStudio, and add a line to read in the file from the URL you’ve copied. You should use <code>read_csv()</code> and don’t forget to store the result into a named object: <code>batted_balls</code>.</li>
<li>Run your code using either <code>ctrl+Enter</code> or <code>cmd+Return</code>, and then check the <code>Environment</code> tab of your top-right pane in RStudio to confirm that you have a new Data object called <code>batted_balls</code>.</li>
</ul>
<ol start="4" type="1">
<li>Repeat Step 3, but read in <code>park_dimensions.csv</code> instead.</li>
</ol>
</section>
<section id="viewing-data" class="level2">
<h2 class="anchored" data-anchor-id="viewing-data">Viewing Data</h2>
<p>Now that we’ve got data, the first thing we should do is look at it. There are a few really handy R functions for <em>getting a feel</em> for the data you have access to. The <code>View()</code>, <code>head()</code>, <code>tail()</code>, and <code>glimpse()</code> functions are four that are really commonly used. The <code>skim()</code> function from the <code>{skimr}</code> package is also one that you should add to your toolbox.</p>
<ol start="5" type="1">
<li>Open a new code cell in your Quarto notebook by using the <code>+C</code> button at the top of the top-left pane in RStudio and choosing R as the language for the code cell. Use the functions mentioned above to explore your <code>batted_balls</code> and <code>park_dimensions</code> data frames.</li>
</ol>
</section>
<section id="manipulating-data" class="level2">
<h2 class="anchored" data-anchor-id="manipulating-data">Manipulating Data</h2>
<p>Now that we know how to load and view our data, let’s talk about manipulating it. We can restrict the data we are working with, produce summaries of the data, transform the data, and more.</p>
<section id="pipes" class="level3">
<h3 class="anchored" data-anchor-id="pipes">Pipes <code>%&gt;%</code></h3>
<p>Pipes are a functionality that is included in a package that is part of <code>{tidyverse}</code> library. At first, the syntax may seem a bit strange, but pipes allow you to easily manipulate data without having to rename and save the data set along the way. We’ll use pipes extensively in our course. In the previous section we saw how to use R’s <code>head()</code> function to look at the first six rows of the dataset. Here’s how to achieve the same outcome with the use of the pipe (<code>%&gt;%</code>) operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can read the code above as saying “take the <code>batted_balls</code> data set, and plug it into the <code>head()</code> function”. Putting <code>head()</code> indented on a new line is not necessary for the code to work, but it does make the code easier to read.</p>
<ol start="6" type="1">
<li>Rewrite your functions from earlier to use the pipe operator.</li>
</ol>
<p>This new method of asking to view our data may seem silly and inefficient, but the real magic of the pipe is that it allows us to chain operations together in a way that mimics the way humans think about instructions. We’ll see this in action as we get exposure to more data manipulation tools below.</p>
</section>
<section id="restricting-data" class="level3">
<h3 class="anchored" data-anchor-id="restricting-data">Restricting Data</h3>
<p>The most common methods for restricting data deal with filtering out rows or columns so that we are only working with a subset of our original data set.</p>
<section id="filtering-rows-filter" class="level4">
<h4 class="anchored" data-anchor-id="filtering-rows-filter">Filtering Rows (<code>filter()</code>)</h4>
<p>Sometimes we are not interested in all of the observations in a particular data set, but only those satisfying certain criteria. For example, maybe we only want to see <code>batted_balls</code> where the <code>pitch_name</code> is <code>"Changeup"</code>. The <code>filter()</code> function will allow us to get rid of all other classes of <code>pitch_type</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pitch_name <span class="sc">==</span> <span class="st">"Changeup"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also use more complex conditions on which rows to see using <em>and</em> (<code>&amp;</code>) and <em>or</em> (<code>|</code>) statements. Maybe we want to see only those <code>batted_balls</code> whose <code>bearing</code> is <code>"center"</code> and whose <code>launch_speed</code> exceeds 100mph.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((bearing <span class="sc">==</span> <span class="st">"center"</span>) <span class="sc">&amp;</span> (launch_speed <span class="sc">&gt;</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="7" type="1">
<li><p>Add another new code cell and use it to write and execute the filtering operations above. Verify that they work as expected.</p></li>
<li><p>Create a copy of the code to show <code>batted_balls</code> whose <code>bearing</code> is <code>"center"</code> <strong>and</strong> whose <code>launch_speed</code> exceeds 100mph, and change it so that you obtain all <code>batted_balls</code> whose <code>bearing</code> is <code>"center"</code> <strong>or</strong> whose <code>launch_speed</code> exceeds 100mph.</p></li>
<li><p>Add another new code cell and perform at least one additional filtering operation that you are interested in.</p></li>
</ol>
</section>
<section id="selecting-columns-select" class="level4">
<h4 class="anchored" data-anchor-id="selecting-columns-select">Selecting Columns (<code>select()</code>)</h4>
<p>Similarly to the way we can <code>filter()</code> rows, we can <code>select()</code> only those columns we are interested in. We can pass the names of the columns we are interested in to R’s <code>select()</code> function so that we only see those selected columns returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(batter_team, bb_type, bearing, inning, pitch_mph, launch_speed, launch_angle, is_home_run) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also select all columns <em>except</em> certain ones by preceding the column name with a <code>-</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>bip_id,<span class="sc">-</span>batter_id, <span class="sc">-</span>pitcher_id) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>select()</code> function is also useful for changing the order of the columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(batter_name, pitcher_name, bb_type, is_home_run, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the code cell above, we used a helper function <code>everything()</code> inside of <code>select()</code> to indicate that we wanted all of the remaining columns in their original order.</p>
<ol start="10" type="1">
<li><p>Open another new code cell to confirm that the code from the blocks above work as expected.</p></li>
<li><p>In an additional new code cell, explore the use of <code>select()</code> on your own. Can you call <code>select()</code> twice in a pipeline? Try it! What happens?</p></li>
</ol>
<p>We can combine <code>filter()</code> and <code>select()</code> through the pipe as well. For any pipe, the result of the “upstream” code (the code before the pipe) is passed into the function that follows the pipe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(home_team <span class="sc">==</span> <span class="st">"BOS"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(away_team, batter_team, batter_name, pitcher_name, bb_type, bearing, pitch_name, is_home_run) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>A Note on Pipes:</strong> The advantage to the pipe operator is probably pretty clear by now. The code we just wrote says <em>take the <code>batted_balls</code> data set, filter it so that we only see batted balls when Boston is the home team, show me only the few columns I am interested in, and just let me see the first six rows for now</em>. The alternative to this would be writing code that looks a lot less readable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">select</span>(<span class="fu">filter</span>(batted_balls, home_team <span class="sc">==</span> <span class="st">"BOS"</span>), away_team, batter_team, batter_name, pitcher_name, bb_type, bearing, pitch_name, is_home_run))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="summarizing-data" class="level3">
<h3 class="anchored" data-anchor-id="summarizing-data">Summarizing Data</h3>
<p>There are lots of ways we can summarize our data. We can provide simple counts, compute averages, even build out our own summary functions.</p>
<section id="computing-counts" class="level4">
<h4 class="anchored" data-anchor-id="computing-counts">Computing Counts</h4>
<p>We can start with a simple question like, <em>how many batted balls from each team are contained in this data set?</em> To answer this, we simply pipe the <code>batted_balls</code> data frame into the <code>count()</code> function, identifying the <code>batter_team</code> column as the column we wish to count.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(batter_team) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="12" type="1">
<li>Open another new code cell in your notebook and use it to run the code above.</li>
</ol>
<p>The counts are displayed in alphabetical order by <code>batter_team</code>. We might be interested in the teams with the most <code>batted_balls</code>. We’ll do this with <code>arrange()</code> – we can pass this function the argument <code>-n</code> to say that we want to arrange by our new count column in descending order, and let’s ask for the top 10 rows instead of the top 6.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(batter_team) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="13" type="1">
<li>Verify that the code above works as described by editing the code in your most recent cell and running it.</li>
</ol>
<p>Let’s say we wanted to know how the distribution of <code>pitch_type</code> against each of the different teams (<code>batter_team</code>) when there are 2 outs (<code>outs_when_up</code>). This is a more complicated question. We would first need to filter the data so that we are only considering batted balls, when the number of <code>outs_when_up</code> is 2. Then we would <code>count()</code> <code>home_team</code> and <code>pitch_name</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>battedballs <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outs_when_up <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(home_team, pitch_name) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="14" type="1">
<li><p>Again, verify that the code above works as described using a new code cell. Note that adding <code>head(10)</code> to our pipeline prevents lots of rows of data being printed into our notebook.</p></li>
<li><p>Add another new code cell and compute summaries of categorical variables that you find interesting.</p></li>
</ol>
</section>
<section id="summarizing-numerical-data" class="level4">
<h4 class="anchored" data-anchor-id="summarizing-numerical-data">Summarizing Numerical Data</h4>
<p>Summarizing categorical data is most often done with counts, but we’ve got many more choices when we are working with numerical data. We have several measures of center or spread that we could choose from – we could even define our own metrics. Let’s say we wanted to know the median <code>launch_speed</code> across all of the batted balls in our data set. We’ll need the help of R’s <code>summarize()</code> function as well as the <code>median()</code> function for this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_launch_speed =</span> <span class="fu">median</span>(launch_speed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="15" type="1">
<li>Open another new code cell in your notebook and try the code above. What do you get for a median launch speed?</li>
</ol>
<p>At least one of the rows in our data frame does not have a recorded <code>launch_speed</code>. That row contains missing data (<code>NA</code>) – these <code>NA</code> values are <em>contagious</em>. That is, any calculation done with <code>NA</code> values results in an <code>NA</code> value. If we don’t want this behavior, we can either <code>filter()</code> out any rows containing missing values prior to using <code>summarize()</code>, or some functions have an <code>na.rm</code> argument which can be set to <code>TRUE</code> to omit missing values from the calculation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(launch_speed)) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_launch_speed =</span> <span class="fu">median</span>(launch_speed))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median_launch_speed =</span> <span class="fu">median</span>(launch_speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="16" type="1">
<li><p>Add the code above to your existing code cell. Execute it to verify that both versions of the calculation for median launch speed result in the same computed value.</p></li>
<li><p>Using a new code cell, compute the maximum (<code>max()</code>) launch angle for a batted ball in the data set.</p></li>
</ol>
<p>With the use of <code>summarize()</code> we can get multiple summaries at once. Let’s compute the mean and standard deviation for both the <code>pitch_mph</code> and <code>launch_speed</code> across all of the batted balls in our data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_pitch_mph =</span> <span class="fu">mean</span>(pitch_mph, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">std_deviation_pitch_mph =</span> <span class="fu">sd</span>(pitch_mph, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_launch_speed =</span> <span class="fu">mean</span>(launch_speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">std_deviation_launch_speed =</span> <span class="fu">sd</span>(launch_speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="18" type="1">
<li>As usual, open a code cell to compute the summary statistics using the code above.</li>
</ol>
<p>It might be useful if we could get grouped summary statistics. Let’s use <code>group_by()</code> to see how these measures vary across pitch type (<code>pitch_name</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pitch_name) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_pitch_mph =</span> <span class="fu">mean</span>(pitch_mph, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">std_deviation_pitch_mph =</span> <span class="fu">sd</span>(pitch_mph, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_launch_speed =</span> <span class="fu">mean</span>(launch_speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">std_deviation_launch_speed =</span> <span class="fu">sd</span>(launch_speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="19" type="1">
<li>Use a code cell to verify the results of the code above. Can you arrange the results in order of mean launch speed, from slowest to fastest?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pitch_name) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_pitch_mph =</span> <span class="fu">mean</span>(pitch_mph, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">std_deviation_pitch_mph =</span> <span class="fu">sd</span>(pitch_mph, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_launch_speed =</span> <span class="fu">mean</span>(launch_speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">std_deviation_launch_speed =</span> <span class="fu">sd</span>(launch_speed, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean_launch_speed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That’s pretty informative! Do you notice anything surprising in the output?</p>
</section>
</section>
<section id="transforming-data" class="level3">
<h3 class="anchored" data-anchor-id="transforming-data">Transforming Data</h3>
<p>Often, you may be in a situation where you would like to create new columns, using the existing columns. This can be done using the <code>mutate()</code> command. The syntax is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_column_name =</span> function_of_old_columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the <code>batted_balls</code> data set, let’s add a computed column for the vertical launch velocity of the batted ball. The vertical launch velocity can be computed as <code>launch_speed</code> * <code>sin(launch_angle*(pi/180))</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">vertical_launch_velocity =</span> launch_speed <span class="sc">*</span> <span class="fu">sin</span>(launch_angle<span class="sc">*</span>(pi<span class="sc">/</span><span class="dv">180</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="20" type="1">
<li><p>Again, add a code cell to verify that the code above works as described.</p></li>
<li><p>Update your code to add another column for the <code>horizontal_launch_velocity</code>. It is computed the same way, but uses <code>cos()</code> instead of <code>sin()</code>. You can do this by piping your existing code into another <code>mutate()</code> or by separating the columns to be computed by a comma in a single call to <code>mutate()</code>.</p></li>
</ol>
<p>Once pretty common step in an analysis is to create a categorical column from a variable which was originally numeric. In order to do this we can use the <code>case_when()</code> function. The structure of this function is a collection of subsequent tests and their corresponding results if true. It will be easier to see in an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">launch_speed_categorical =</span> <span class="fu">case_when</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    (launch_speed <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">~</span> <span class="st">"Very Fast"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    (launch_speed <span class="sc">&gt;</span> <span class="dv">80</span>) <span class="sc">~</span> <span class="st">"Fast"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    (launch_speed <span class="sc">&gt;</span> <span class="dv">65</span>) <span class="sc">~</span> <span class="st">"Meh"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    (launch_speed <span class="sc">&gt;</span> <span class="dv">40</span>) <span class="sc">~</span> <span class="st">"Kinda Slow"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">is.na</span>(launch_speed)) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Was it even moving?"</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="22" type="1">
<li>Use another new code cell to try the code above. Before you execute the code, what do you think should happen? After executing the code, do your expectations match the output?</li>
</ol>
</section>
<section id="joining-data" class="level3">
<h3 class="anchored" data-anchor-id="joining-data">Joining Data</h3>
<p>It’s not always the case that our data all lives neatly in a single table. Most often our data is split across multiple tables. This is the case in our baseball scenario. Useful information is stored away in the <code>park_dimensions()</code> data set. Storing this data separately reduces redundancy, reduces storage size, and improves reliability. If we want to use <code>park_dimensions</code> information in understanding our <code>batted_balls</code> data, then we can <em>join</em> the <code>park_dimensions</code> data onto our <code>batted_balls</code> data. A <em>join</em> matches two tables using at least one shared column – the resulting table includes columns from both of the individual tables.</p>
<p>There are several different types of join, but we’ll almost always be able to get away with a <em>left-join</em>. This particular type of join begins with a table (on the left) and adds columns from another table (the table on the right) by matching on a shared column(s).</p>
<p>A left-join to add the <code>park_dimensions</code> variables onto the <code>batted_balls</code> data appears below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(park_dimensions, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"park"</span> <span class="ot">=</span> <span class="st">"park"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>by</code> argument is a list of column matches. The name of the column in the table on the left (the one before the pipe) appears to the left of the equals sign (=), and the name of the column in the table on the right appears after the equal sign. If we are joining on multiple columns, we can use a comma (,) and include additional sets of column matches inside of the <code>c()</code> function after <code>by</code>.</p>
<ol start="23" type="1">
<li>Include another additional code cell and verify that the resulting data frame includes all of the original columns from <code>batted_balls</code> as well as the columns from <code>park_dimensions</code>. You can spot-check a few rows to ensure that the correct park dimension data has been appended to each row.</li>
</ol>
</section>
</section>
<section id="wide--and-long-format-data-frames" class="level2">
<h2 class="anchored" data-anchor-id="wide--and-long-format-data-frames">Wide- and Long-Format Data Frames</h2>
<p>It is common to find a need to reshape your data. Some formats are convenient for analysis, while other formats are convenient for presentation or storage. The <code>{tidyverse}</code> provides two functions whose job it is to reshape data frames from wide to long (<code>pivot_longer()</code>) or from long to wide (<code>pivot_wider()</code>). The process of transforming a data frame from <em>wide</em> format to <em>long</em> format is done by collapsing several columns down to just two – one containing the old column names and another containing the corresponding values under those old columns. Let’s see that below on a simple data set that we’ll construct. For context, let’s assume that the data set below contains growth measurements in centimeters for plants placed in four different types of fertilizer (<code>A</code> - <code>D</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>num_obs <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>wide_fertilizer_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"day"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>num_obs,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"A"</span> <span class="ot">=</span> <span class="fu">runif</span>(num_obs, <span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"B"</span> <span class="ot">=</span> <span class="fu">runif</span>(num_obs, <span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"C"</span> <span class="ot">=</span> <span class="fu">runif</span>(num_obs, <span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"D"</span> <span class="ot">=</span> <span class="fu">runif</span>(num_obs, <span class="dv">0</span>, <span class="dv">4</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>wide_fertilizer_data <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"striped"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">A</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">B</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">C</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.0679890</td>
<td style="text-align: right;">2.3972403</td>
<td style="text-align: right;">2.323167</td>
<td style="text-align: right;">0.1349421</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.9878656</td>
<td style="text-align: right;">3.8843465</td>
<td style="text-align: right;">2.332849</td>
<td style="text-align: right;">0.2705494</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">3.2902857</td>
<td style="text-align: right;">3.0009086</td>
<td style="text-align: right;">2.560319</td>
<td style="text-align: right;">2.1522574</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.4895784</td>
<td style="text-align: right;">2.6381585</td>
<td style="text-align: right;">3.675958</td>
<td style="text-align: right;">2.9614108</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2.1065929</td>
<td style="text-align: right;">0.6014596</td>
<td style="text-align: right;">0.454770</td>
<td style="text-align: right;">3.3159070</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>In the simulated dataset above, the columns <code>A</code> - <code>D</code> aren’t variables that are being measured. They are <em>levels</em> of a categorical variable, <code>fertilizer_type</code>. In order to make this data <em>tidy</em> for analysis, we’ll need to pivot those four fertilizer types into a new column, and collapse the recorded growth values into another new column. This means that each <code>day</code> will be repeated four times…once for each of the four fertilizer types. We should go from a data frame with five rows to one with twenty (a longer data frame!). Let’s see that with <code>pivot_longer()</code> below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>long_fertilizer_data <span class="ot">&lt;-</span> wide_fertilizer_data <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>), <span class="at">names_to =</span> <span class="st">"fertilizer_type"</span>, <span class="at">values_to =</span> <span class="st">"growth"</span>) </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>long_fertilizer_data <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"striped"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">day</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">fertilizer_type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">growth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3.0679890</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">2.3972403</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">2.3231665</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">0.1349421</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2.9878656</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">3.8843465</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">2.3328489</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">0.2705494</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3.2902857</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">3.0009086</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">2.5603185</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">2.1522574</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">0.4895784</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">2.6381585</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">3.6759584</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">2.9614108</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2.1065929</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">0.6014596</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">0.4547700</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">3.3159070</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The longer data frame is more difficult for us to extract meaning from than the original wide data frame. However, this wide-format data frame is much better suited for analysis.</p>
<p>The <code>pivot_wider()</code> function can be though of as the inverse of the <code>pivot_longer()</code> function. We can use it to convert our <code>long_fertilizer_data</code> back into <em>wide</em> format. I’ve found <code>pivot_wider()</code> to be really useful when I want to display tables in my notebooks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>wide_again <span class="ot">&lt;-</span> long_fertilizer_data <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="st">"day"</span>, <span class="at">names_from =</span> fertilizer_type, <span class="at">values_from =</span> growth) </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>wide_again <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"striped"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-hover table-striped caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">A</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">B</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">C</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.0679890</td>
<td style="text-align: right;">2.3972403</td>
<td style="text-align: right;">2.323167</td>
<td style="text-align: right;">0.1349421</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.9878656</td>
<td style="text-align: right;">3.8843465</td>
<td style="text-align: right;">2.332849</td>
<td style="text-align: right;">0.2705494</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">3.2902857</td>
<td style="text-align: right;">3.0009086</td>
<td style="text-align: right;">2.560319</td>
<td style="text-align: right;">2.1522574</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.4895784</td>
<td style="text-align: right;">2.6381585</td>
<td style="text-align: right;">3.675958</td>
<td style="text-align: right;">2.9614108</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2.1065929</td>
<td style="text-align: right;">0.6014596</td>
<td style="text-align: right;">0.454770</td>
<td style="text-align: right;">3.3159070</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Being able to quickly reshape data using <code>pivot_longer()</code> and <code>pivot_wider()</code> is a skill that will serve you quite well if you find yourself doing analysis and reporting.</p>
</section>
<section id="misc-additional-items" class="level2">
<h2 class="anchored" data-anchor-id="misc-additional-items">Misc Additional Items</h2>
<p>There is much that we haven’t covered, but a few things definitely worth a quick mention are:</p>
<ul>
<li><p>All of the changes we’ve made to the <code>batted_balls</code> data frame here are temporary. If we want to make any permanent changes, we’ll need to store the results of our data manipulation as a new object with the arrow operator (<code>&lt;-</code>). We overwrite the original object if we use the same name, but can use a different name and keep the original object available in our Global Environment. For example,</p>
<p>::: {.cell}</p>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bb_with_park_dims <span class="ot">&lt;-</span> batted_balls <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(park_dimensions, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"park"</span> <span class="ot">=</span> <span class="st">"park"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p></li>
<li><p>The table outputs we’ve obtained while running our code look quite nice. If we <code>Knit</code> our document (using the blue ball of yarn icon), then the tables appearing in the HTML output are not nearly as readable. The <code>kableExtra</code> package provides functionality to convert our tables into visually pleasing components of our HTML document. For example,</p>
<p>::: {.cell}</p>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>bb_with_park_dims <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"striped"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p></li>
</ul>
<p>The code in the block above will produce a nicely formatted table in which the rows are striped and if we hover over a row of our table then it will be highlighted in the HTML document. Try adding a code cell as above and then re-knitting your document. See how nice this table looks? You might copy and paste these lines to the end of each of our code cells in this notebook that output tables. The document resulting from your knitting will be much more visually pleasing.</p>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h2>
<p>There is a lot more to learn about data manipulation and R in general. Sticking to the <code>{tidyverse}</code> and the other package groups within the <em>tidy</em>-ecosystem (ie. <code>{tidytext}</code>, <code>{tidymodels}</code>, etc.) will be beneficial because they are all built on common syntax and programmatic principles. You can read more about this in the <a href="https://tidyverse.tidyverse.org/articles/manifesto.html">TidyTools Manifesto</a>.</p>
<p>You won’t be an expert after working through this document, but it should provide you with a solid start. Please feel free to continue adding notes to your markdown file as we encounter more advanced functionality.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>