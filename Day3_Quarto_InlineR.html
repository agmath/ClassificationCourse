<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Gilbert">
<meta name="dcterms.date" content="2025-01-02">

<title>Quarto and Inline R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Day3_Quarto_InlineR_files/libs/clipboard/clipboard.min.js"></script>
<script src="Day3_Quarto_InlineR_files/libs/quarto-html/quarto.js"></script>
<script src="Day3_Quarto_InlineR_files/libs/quarto-html/popper.min.js"></script>
<script src="Day3_Quarto_InlineR_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Day3_Quarto_InlineR_files/libs/quarto-html/anchor.min.js"></script>
<link href="Day3_Quarto_InlineR_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Day3_Quarto_InlineR_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Day3_Quarto_InlineR_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Day3_Quarto_InlineR_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Day3_Quarto_InlineR_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Quarto and Inline R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Gilbert </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 2, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><strong>Purpose:</strong> This notebook will remind you how to use and navigate Quarto documents. In particular it will cover</p>
<ul>
<li>the basic structure of a Quarto document.</li>
<li>the <em>Visual</em> editor versus the <em>Source</em> editor.</li>
<li>code chunks versus <em>markdown</em> “cells”.</li>
<li>formatting text and creating lists within code cells.</li>
<li>using inline R code to semi-automate reporting.</li>
</ul>
<p><strong>Note:</strong> Returning students who are familiar with Quarto may want to skip immediately to the section on <a href="#inline-r">inline R code</a>. New students may want to focus on the first three sections and may or may not get to the section on inline R.</p>
<p><strong>Goal and Clarification:</strong> After leaving this notebook, you should be comfortable working in Quarto notebooks and switching between code and text fluently. The use of inline R is not required in our course, though it can reduce some tedious components of your document-writing workload.</p>
<section id="basic-structure-of-a-quarto-document" class="level2">
<h2 class="anchored" data-anchor-id="basic-structure-of-a-quarto-document">Basic Structure of a Quarto Document</h2>
<p>In simplest terms, any Quarto document contains three major components.</p>
<ul>
<li>A <em>Yet Another Markup Language</em> (YAML) header</li>
<li>Code chunks with grey background</li>
<li>Text “cells” with white background</li>
</ul>
<section id="yaml-header" class="level4">
<h4 class="anchored" data-anchor-id="yaml-header">YAML Header</h4>
<p>The YAML header contains important components such as your document’s <code>title</code>, the <code>author</code>s and also instructions for how your document should be processed upon <em>rendering</em>. As a reminder, <em>rendering</em> is the process of turning the <code>*.qmd</code> file into a shareable document. I like to use HTML outputs but PDF, Word, Powerpoint, and other output options also exist.</p>
<p>The YAML header appears at the top of any Quarto document between sets of three hyphens (<code>---</code>), sometimes referred to as <em>fences</em>. You can see an example of such a header below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>title<span class="sc">:</span> <span class="st">'Quarto and Inline R'</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>author<span class="sc">:</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span> <span class="st">"Dr. Gilbert"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span> <span class="st">"Dr. Duryea"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>date<span class="sc">:</span> today</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>format<span class="sc">:</span> html</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>theme<span class="sc">:</span> flatly</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>format:</code> section controls how the document will be processed when the <em>render</em> button is pushed. For this notebook we’ll be generating an <code>html</code> document and we’re planning to use the <em>flatly</em> <code>theme:</code>; you can <a href="https://quarto.org/docs/output-formats/html-themes.html">see some other available themes here</a> – setting the theme quickly changes things like font, heading size/style, color schemes, and more. If you know some CSS, then you can do anything you want here, either modifying an existing theme or creating your own from scratch.</p>
<p>For the most part you should be able to copy/paste your YAML headers from one document to the next, just changing the document title and perhaps author(s). In fact, I used to start a new Quarto notebook by opening an old notebook, navigating to <code>File -&gt; Save As...</code> to save the new notebook, and then removing what I don’t want before creating the new document. I did this for a very long time.</p>
</section>
<section id="code-chunks" class="level4">
<h4 class="anchored" data-anchor-id="code-chunks">Code Chunks</h4>
<p>As mentioned in the bulleted list, code chunks are accompanied by a grey background. They are where you can write and execute the code associated with your analysis. We’ll specifically be using R, but you can use several other languages in these notebooks including Python and SQL. It is even possible to pass objects back and forth between languages within the same notebook – this is great if you like Python for some things and R for others or if you have collaborators who prefer to work in different languages.</p>
<p>We’ll cover more on code chunks later in this notebook. For now, we’ll just highlight that code chunks begin and end with three back-ticks. The set of back ticks at the beginning of a code cell will also have curly braces with options for the code cell – at a minimum, we’ll provide the language being used in all lowercase letters. For example, below creates a default R code chunk in a Quarto document.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>#R code goes here</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>```</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="text-cells" class="level4">
<h4 class="anchored" data-anchor-id="text-cells">Text “Cells”</h4>
<p>Everything else in a Quarto document is text. As mentioned in the bulleted list, if you are typing over a white background, then you are typing freeform text. More will be discussed on text later in this notebook.</p>
</section>
</section>
<section id="visual-editor-versus-source-editor" class="level2">
<h2 class="anchored" data-anchor-id="visual-editor-versus-source-editor">Visual Editor versus Source Editor</h2>
<p>If you are just getting used to working in R and Quarto, you might prefer using the Visual editor since it provides an interface more like MS Word. That is, it makes formatting buttons available to you so that you don’t need to remember the markdown syntax for different font styles, hyperlinks, or lists. You can work from either the Source or Visual editors – the choice is yours. You can toggle back and forth from the top-left corner of the pane where you are typing your Quarto document. I think it is worth eventually getting used to the <em>source</em> editor since you’ll be much faster working from there than you will from the visual editor.</p>
</section>
<section id="code-chunks-1" class="level2">
<h2 class="anchored" data-anchor-id="code-chunks-1">Code Chunks</h2>
<p>As mentioned earlier, code chunks are where you can write and execude R code (and code in other languages too, if you like). Code chunks appear with a grey background in a Quarto notebook. There are several ways you can create a code cell.</p>
<ul>
<li>You can manually create a code cell by typing in the opening and closing sets of triple backticks. Don’t forget to declare the language in the curly braces immediately next to the opening triple backtick.</li>
<li>You can click the green “+C” icon at the top of the markdown editing pane and select the language you want the code cell to recognize.</li>
<li>If you are in the visual editor, you can type a forward slash (/) and choose the type of code chunk you want from the dropdown list that appears.</li>
</ul>
<p><strong>Note:</strong> All code written in a code cell must run without error or the code will prevent your document from being rendered.</p>
<section id="options-for-code-chunks" class="level4">
<h4 class="anchored" data-anchor-id="options-for-code-chunks">Options for Code Chunks</h4>
<p>It is possible to declare options for code chunks. You’ve seen me doing this often if you’ve looked at any of my Quarto documents for classes. Options can either appear inside the curly braces after the language declared for the chunk and are separated by commas or at the very top of the code chunk using the <em>hash-pipe</em> operator (<code>#|</code>) followed by the setting. Some common options appear below.</p>
<ul>
<li><p><code>echo = TRUE</code> says to print out the code cell to the notebook. That is, your notebook will contain the code. Note that <code>TRUE</code> is the default for this setting – it is common that you’ll want to set <code>echo = FALSE</code> in your final drafts of notebooks. Displaying the code to produce the analysis can be distracting to the person reading your notebook.</p></li>
<li><p><code>eval = TRUE</code> says that the code in the code cell should be evaluated. Note that <code>TRUE</code> is the default for this, but setting <code>eval = FALSE</code> can help you with troubleshooting broken code or to prevent cells that take a long time to run from running during the knitting process. Just beware, if a code cell is not evaluated, then no later code can use results from the code cell, otherwise errors will be thrown.</p></li>
<li><p><code>message = FALSE</code> and/or <code>warning = FALSE</code> can be used to prevent messages and warnings from being knitted into your notebook. I find these particularly useful when working with <code>ggplot()</code>.</p></li>
<li><p><code>fig.cap = "description of figure"</code> can be used to caption any figures that result from the execution of the code cell.</p></li>
<li><p><code>cache = TRUE</code> is a setting that can save you lots of knitting time. Use it sparingly, but some places you might use it are:</p>
<ul>
<li>code chunks where large plots are being constructed.</li>
<li>code chunks running cross-validation and hyperparameter tuning.</li>
<li>code chunks fitting large models.</li>
</ul></li>
</ul>
<p>Your Quarto notebook can contain as many code chunks as you like. Typically notebooks contain a mixture of code chunks and text “cells” following the YAML header at the top of the notebook.</p>
</section>
</section>
<section id="text-cells-1" class="level2">
<h2 class="anchored" data-anchor-id="text-cells-1">Text “Cells”</h2>
<p>The remainder of your notebook will consist of text “cells” where you can type freely. If you are using the visual <em>editor</em>, you can use the formatting buttons to change the font style (italics, bold, etc.), create bulleted or numbered lists, insert images, etc. If you are using the <em>source</em> editor, then the following tips will be helpful.</p>
<ul>
<li>Create a new paragraph by including an empty line in your Quarto source file.</li>
<li>Format text in <em>italics</em> by surrounding the text by a single asterisk on each side.</li>
<li>Format text in <strong>bold</strong> by surrounding the text by a double asterisk on each side.</li>
<li>Create bulleted list items by beginning each line with a <code>+</code> sign. You’ll need an empty line in your Quarto document before beginning the list.</li>
<li>You can create nested lists by indenting with the <code>tab</code> key. You’ll need an empty line in your Quarto document before the new, indented level though.</li>
<li>Numbered lists are created in the same way as bulleted lists – you just begin each line with <code>1.</code> instead of with <code>+</code>. You can manually increment you numbers or R will automatically incremement them if you begin every line with <code>1.</code>.</li>
<li>Titles, Section Headings, Subsection Headings, etc. can be created by setting them on their own line and beginning that line with one or more hashtags (#). The more hashtags you use, the smaller the heading.</li>
<li>Hyperlinks are created by surrounding the text you want the hyperlink attached to with square brackets and immediately following those with round parentheses having the URL inside of them. For example <code>[course webpage](https://agmath.github.io/ClassificationCourse.html)</code> would create a hyperlink to our course webpage and the blue link text would be <em>course webpage</em>.</li>
</ul>
</section>
<section id="inline-r" class="level2">
<h2 class="anchored" data-anchor-id="inline-r">Inline R Code</h2>
<p>You can really supercharge your productivity and explanation power by using inline R code. You can use inline-R by typing a backtick followed by a lowercase <code>r</code> and then the R code that you want to run, closing the R code with another backtick. For example, typing <code></code> would calculate the number of rows in the data frame stored in the object called <code>data</code>. If you’re not convinced that this is useful, consider the following sentence which might appear in a document you are preparing.</p>
<blockquote class="blockquote">
<p><em>This report was prepared using all available web traffic data over the past week. Over that time period we had 348 visitors to our site.</em></p>
</blockquote>
<p>If this is a weekly report, then every week you would need to replace the 348 with the correct number of visitors for the new time period. Assuming that the data we are using comes from a data frame called <code>site_traffic</code>, we could write the following into our report to avoid the need for manual updating.</p>
<blockquote class="blockquote">
<p><em>This report was prepared using all available web traffic data over the past week. Over that time period we had <code>` r site_traffic %&gt;% nrow()`</code> visitors to our site.</em></p>
</blockquote>
<p>Now think about how you could use similar techniques to automatically fill in or update sections of reports by using inline R code. Making use of inline R has the potential to really boost your efficiency!</p>
<section id="lists-and-inline-r" class="level4">
<h4 class="anchored" data-anchor-id="lists-and-inline-r">Lists and Inline R</h4>
<p>Inline R is great, but writing lengthy commands inline is unweildy, difficult to troubleshoot, and difficult to read. For example, the following sentence includes inline code required to extract a model coefficient from a fitted model.</p>
<blockquote class="blockquote">
<p>The fitted coefficient on <code>flipper_length</code> in our model is <code>` r model_fit %&gt;% extract_fit_engine() %&gt;% tidy() %&gt;% filter(term == "flipper_length") %&gt;% pull(estimate)`</code> .</p>
</blockquote>
<p>It can be useful to pre-compute these values and store them into a named list so that they can be more easily used inline. All this just means, putting more complex code into a code chunk to build a list because extracting list elements inline is easier than extracting them from their native environment. For example, we could use a code cell like the one below to obtain all of the coefficients for a model into a named vector called <code>coef_list</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>coef_list <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  lr_summary <span class="sc">%&gt;%</span> <span class="fu">pull</span>(estimate)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(coef_list) <span class="ot">&lt;-</span> lr_summary <span class="sc">%&gt;%</span> <span class="fu">pull</span>(term)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This would now allow us to rewrite the sentence with inline R code from above as follows.</p>
<blockquote class="blockquote">
<p>The fitted coefficient on <code>flipper_length</code> in our model is <code>` r coef_list["flipper_length"]`</code>.</p>
</blockquote>
<hr>
</section>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next Steps</h2>
<p>Your next homework assignment will give you an opportunity to try what you’ve learned by working with our Kaggle InClass competition data on property price ranges in a Quarto notebook. Be sure to keep your notebook in the directory corresponding to your GitHub repository that is being managed by RStudio – don’t forget to <code>Pull -&gt; Commit -&gt; Push</code> your changes to your GitHub repository when you want to create checkpoints for your notebook.</p>
<p>See Slack for a link to the Kaggle Competition site, where our data lives.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>